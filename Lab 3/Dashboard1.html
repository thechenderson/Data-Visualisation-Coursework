<!--
Author: Christohper Henderson
Project: Data Visualisation and Analytics Lab 3
Date: 14/03/22
URL: https://github.com/thechenderson/Data-Visualisation-Coursework
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Vaccine Dashboard 1</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src='https://d3js.org/d3.v7.min.js'></script>

    </head>
    <body>

        <!-- Create an element where the map will take place -->
        <svg width="1200" height="750"></svg>

        <div class="tooltip"></div>

        <style>
            div.tooltip {
                color: rgb(0, 0, 0); 
                font-size: 100;
                font-family:Arial, Helvetica, sans-serif;
                background: rgb(4, 147, 241); 
                border-radius: 3px; 
                box-shadow: 0px 0px 2px 0px #a6a6a6; 
                padding: .2em; 
                opacity: 0.9; 
                position: absolute;
            }
        </style>
        
        <script>
            // The svg
            const svg = d3.select("svg"),
                width = +svg.attr("width"),
                height = +svg.attr("height");
            
            // Map and projection
            const projection = d3.geoNaturalEarth1()
                .scale(width / 1.3 / Math.PI)
                .translate([width / 2, height / 2])
            
            // Load external data and boot
            d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then( function(data) {
            

                var tooltip = d3.select("div.tooltip");
                // Draw the map
                svg.append("g")
                    .selectAll("path")
                    .data(data.features)
                    .enter()
                        .append("path")
                            .attr("fill", "gray")
                            .attr("d", d3.geoPath().projection(projection))
                            
                            .on("mouseover", function (event, d) {
                                tooltip.style("opacity", 1).html(d.properties.name + "<br>" + getVaccData(d.properties.name))                        

                                d3.select(this)
                                    .transition()
                                        .style("fill", "red")
                                        .duration(300)
                            })
                            
                            .on("mousemove",function(event, d){
                                tooltip.style("opacity", 1)
                                .style("left", (event.x)-40 + "px")
                                .style("top", (event.y)-60 + "px")
                                .html(d.properties.name + "<br>"+ getVaccData(d.properties.name));
                            })
                            
                            .on("mouseout", function (event, d) {
                                d3.select(this)
                                    .transition()
                                        .style("fill", "gray")
                                        .duration(600)
                                        tooltip.style("opacity", 0)
                                
                            })
                            .style("stroke", "#fff")
                            
               
            


            })
            

            function getVaccData(country) {
                d3.csv('https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/vaccinations/vaccinations.csv', function(data){
                    var vaccinations = d3.filter(data, function(d){
                        console.log(d.location)
                        if(d.location == country){
                            return d
                        }
                        })
                })
            }

            </script>


        
    </body>
</html>